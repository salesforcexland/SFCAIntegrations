{
  "id": "5a1dfb21-3bcd-4ed7-9412-84e924b2e517",
  "name": "run-salesforce-code-analyzer",
  "friendlyName": "Salesforce Code Analyzer - ADO PR Scan",
  "description": "Runs Salesforce Code Analyzer v5 against PR delta files in Azure DevOps and enforces violation thresholds.",
  "author": "Sam Crossland",
  "helpMarkDown": "Only runs on pull requests and scans the changed files for code quality violations.",
  "category": "Build and release",
  "visibility": [ "Build" ],
  "runsOn": [ "Agent" ],
  "instanceNameFormat": "SFCA PR Scan",
  "iconPath": "icon.png",
  "version": {
    "Major": 0,
    "Minor": 1,
    "Patch": 42
  },
  "inputs": [
    {
      "name": "extensionsToScan",
      "type": "string",
      "label": "File extensions to scan (pipe-delimited)",
      "defaultValue": "cls|trigger|js|html|page|cmp|component|flow-meta.xml",
      "required": false,
      "helpMarkDown": "Pipe-delimited list of file extensions to include in the scan (e.g., cls|trigger|html)"
    },
    {
      "name": "maximumViolations",
      "type": "string",
      "label": "Maximum Allowed Violations",
      "defaultValue": "10",
      "required": false,
      "helpMarkDown": "Maximum number of code violations we would accept before failing the build."
    },
    {
      "name": "stopOnViolations",
      "type": "boolean",
      "label": "Stop build if violations exceed maximum (true/false)",
      "defaultValue": "true",
      "required": false,
      "helpMarkDown": "If true, the build will fail when the number of violations exceeds the threshold."
    },
    {
      "name": "enableSeverityThreshold",
      "type": "boolean",
      "label": "Enable severity threshold scanning",
      "defaultValue": false,
      "helpMarkDown": "Enable to fail the build based on a minimum severity level instead of a total count."
    },
    {
      "name": "violationsThreshold",
      "type": "pickList",
      "label": "Violations Threshold (fail on >=)",
      "required": false,
      "defaultValue": "",
      "helpMarkDown": "Fail the build if any violations meet or exceed this severity. 1 = Info, 5 = Critical.",
      "options": {
        "": "None (no severity threshold)",
        "1": "Info (1)",
        "2": "Low (2)",
        "3": "Moderate (3)",
        "4": "High (4)",
        "5": "Critical (5)"
      },
      "visibleRule": "enableSeverityThreshold = true"
    },
    {
      "name": "postStatusCheckToPR",
      "type": "boolean",
      "label": "Post status check to PR (true/false)",
      "defaultValue": "false",
      "required": false,
      "helpMarkDown": "Boolean to dictate whether we POST an extra status check to the source PR. Requires setting 'env: SYSTEM_ACCESSTOKEN: $(System.AccessToken)' in your pipeline yml."
    }
  ],
  "execution": {
    "Node10": {
      "target": "sfca-orchestrator.js"
    }
  }
}